_context.invoke("Nittro.Extras.Keymap",function(){var Keymap=_context.extend(function(){this._={map:{}}},{STATIC:{MAC:/mac/i.test(navigator.platform),ACTION:"Control"},add:function(key,handler){return key=key.replace(/\baction\b/gi,Keymap.ACTION),this._.map[key]=handler,this},remove:function(key){delete this._.map[key]},get:function(key){return this._.map[key]||null}});Keymap.MAC&&(Keymap.ACTION="Meta"),_context.register(Keymap,"Keymap")},{}),_context.invoke("Nittro.Extras.Keymap",function(Arrays,DOM,undefined){var TabContext=_context.extend("Nittro.Object",function(){TabContext.Super.call(this),this._.items=[],this._.handlers=[],this._.disabled=[],this._.lastFocused=null},{add:function(items){return Array.isArray(items)||(items=Arrays.createFrom(arguments)),this.insert(items)},insert:function(items,index){Array.isArray(items)||(items=[items]),index===undefined&&(index=this._.items.length);var handlers=[],disabled=[];return items.forEach(function(item){if("function"!=typeof item.focus)throw new TypeError("Invalid item: doesn't have a focus() method");var handler=null,dis=!!item.disabled;item instanceof Element?(handler=this._handleFocus.bind(this,item),DOM.addListener(item,"focus",handler)):"function"==typeof item.on&&(handler=this._handleFocus.bind(this,item),item.on("focus",handler)),"function"==typeof item.isDisabled&&(dis=item.isDisabled()),handlers.push(handler),disabled.push(dis)}.bind(this)),items.unshift(index,0),handlers.unshift(index,0),disabled.unshift(index,0),this._.items.splice.apply(this._.items,items),this._.handlers.splice.apply(this._.handlers,handlers),this._.disabled.splice.apply(this._.disabled,disabled),this},setDisabled:function(items,disabled){return Array.isArray(items)||(items=[items]),disabled===undefined&&(disabled=!0),items.forEach(function(item){"number"!=typeof item&&(item=this._.items.indexOf(item),item===-1)||(this._.disabled[item]=disabled)}.bind(this)),this},focus:function(){if(this._.items.length){for(this._.lastFocused=0;this._.disabled[this._.lastFocused];)if(this._.lastFocused++,this._.lastFocused>=this._.items.length)return void(this._.lastFocused=null);this._.items[this._.lastFocused].focus(),this.trigger("focus")}},next:function(cycle){var count=this._.items.length;if(count){var index=this._.lastFocused,start=index,cycled=!1;if(null===index)index=-1,start=0;else if(this._.items[index]instanceof TabContext&&this._.items[index].next(!1))return!0;do if(index++,index>=count){if(cycle===!1)return!1;index%=count,cycled=!0}else if(cycled&&index>=start)return!1;while(this._.disabled[index]);return this._.lastFocused=index,this._.items[index].focus(),!0}},prev:function(cycle){var count=this._.items.length;if(count){var index=this._.lastFocused,start=index,cycled=!1;if(null===index)index=this._.items.length,start=index-1;else if(this._.items[index]instanceof TabContext&&this._.items[index].prev(!1))return!0;do if(index--,index<0){if(cycle===!1)return!1;index+=count,cycled=!0}else if(cycled&&index<=start)return!1;while(this._.disabled[index]);return this._.lastFocused=index,this._.items[index].focus(),!0}},destroy:function(){this._.items.forEach(function(item,index){item instanceof Element?DOM.removeListener(item,"focus",this._.handlers[index]):"function"==typeof item.off&&item.off("focus",this._.handlers[index]),item instanceof TabContext&&item.destroy()}.bind(this)),this._.items=this._.handlers=this._.disabled=null},_handleFocus:function(item){this._.lastFocused=this._.items.indexOf(item)}});_context.register(TabContext,"TabContext")},{Arrays:"Utils.Arrays",DOM:"Utils.DOM"}),_context.invoke("Nittro.Extras.Keymap",function(){var i,Keys={modifiers:{Shift:"shiftKey",Control:"ctrlKey",Alt:"altKey",Meta:"metaKey"},modifierOrder:["Control","Alt","Shift","Meta"],codes:{8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",91:"Meta",93:"Meta",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Meta",225:"AltGraph"}};for(i=0;i<10;i++)Keys.codes[i+48]=i+"";for(i=65;i<91;i++)Keys.codes[i]=String.fromCharCode(i);_context.register(Keys,"Keys")}),_context.invoke("Nittro.Extras.Keymap",function(DOM,Keymap,TabContext,Keys){var Manager=_context.extend(function(){this._={keymaps:[],tabContexts:[]},DOM.addListener(document,"keydown",this._handleKeyDown.bind(this)),DOM.addListener(document,"keyup",this._handleKey.bind(this)),DOM.addListener(document,"keypress",this._handleKey.bind(this))},{STATIC:{RE_TAB:/^(?:Shift\+)?Tab$/},push:function(map){for(var a=0;a<arguments.length;a++)if(arguments[a])if(arguments[a]instanceof Keymap)this._.keymaps.unshift(arguments[a]);else{if(!(arguments[a]instanceof TabContext))throw new TypeError("Invalid argument, must be an instance of Keymap or TabContext");this._.tabContexts.unshift(arguments[a])}else;return this},pop:function(map){var target,a,i;for(a=0;a<arguments.length;a++)arguments[a]&&(arguments[a]instanceof Keymap?target=this._.keymaps:arguments[a]instanceof TabContext&&(target=this._.tabContexts),(i=target.indexOf(arguments[a]))>-1&&target.splice(i,1));return this},_handleKeyDown:function(evt){if(this._.keymaps.length||this._.tabContexts.length){var handler,key=this._extractKey(evt);if(key){if(this._.keymaps.length&&(handler=this._.keymaps[0].get(key)))return evt.preventDefault(),void handler.call(null);this._.tabContexts.length&&Manager.RE_TAB.test(key)&&(evt.preventDefault(),"Tab"===key?this._.tabContexts[0].next():this._.tabContexts[0].prev())}}},_handleKey:function(evt){if(this._.keymaps.length||this._.tabContexts.length){var key=this._extractKey(evt);(this._.keymaps.length&&this._.keymaps[0].get(key)||this._.tabContexts.length&&Manager.RE_TAB.test(key))&&evt.preventDefault()}},_extractKey:function(evt){var key=Keys.codes[evt.which||evt.keyCode];if(key){if(key in Keys.modifiers)return key;var modifiers=[];return Keys.modifierOrder.forEach(function(modifier){evt[Keys.modifiers[modifier]]&&modifiers.push(modifier)}),modifiers.push(key),modifiers.join("+")}}});_context.register(Manager,"Manager")},{DOM:"Utils.DOM"});